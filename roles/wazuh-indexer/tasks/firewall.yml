---
# Wazuh Indexer - Firewall Configuration

- name: Check if firewalld is installed
  ansible.builtin.command: which firewall-cmd
  register: firewalld_check
  changed_when: false
  failed_when: false

- name: Check if ufw is installed
  ansible.builtin.command: which ufw
  register: ufw_check
  changed_when: false
  failed_when: false

# UFW (Debian/Ubuntu)
- name: Configure UFW rules
  when: ufw_check.rc == 0
  block:
    - name: Allow Wazuh Indexer HTTP port
      community.general.ufw:
        rule: allow
        port: "{{ wazuh_indexer_http_port }}"
        proto: tcp
      become: true

    - name: Allow Wazuh Indexer transport port
      community.general.ufw:
        rule: allow
        port: "{{ wazuh_indexer_transport_port }}"
        proto: tcp
      become: true

# Firewalld (RHEL/CentOS)
- name: Configure firewalld rules
  when: firewalld_check.rc == 0
  block:
    - name: Allow Wazuh Indexer HTTP port
      ansible.posix.firewalld:
        port: "{{ wazuh_indexer_http_port }}/tcp"
        permanent: true
        state: enabled
      become: true
      notify: reload firewalld

    - name: Allow Wazuh Indexer transport port
      ansible.posix.firewalld:
        port: "{{ wazuh_indexer_transport_port }}/tcp"
        permanent: true
        state: enabled
      become: true
      notify: reload firewalld
